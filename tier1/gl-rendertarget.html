<link rel="import" href="gl-element.html">

<polymer-element name="gl-rendertarget" extends="gl-element">
<script>Polymer((function static(){
	"use strict;"
	const GL = WebGLRenderingContext.prototype;
	const BINDINGS = {
		viewport:{
			value:function(x,y,width,height){
				this.gl.viewport(x,y,width,height);
				return this;
			}
		},
	};
	const STATES = {
		
	};
	const ACCESSORS = {
		$width:{
			get:function(){
				return this.width||this.clientWidth||document.documentElement.clientWidth;
			}
		},
		$height:{
			get:function(){
				return this.height||this.clientHeight||document.documentElement.clientHeight;
			}
		},
		$programs:{
			get:function(){
				if(this.programquery)
					return [].slice.call(document.querySelectorAll(this.programquery))
						.concat([].slice.call(this.children)).filter(this.programFilter.bind(this));
				else
					return [].slice.call(this.children).filter(this.programFilter.bind(this));
			}
		},
	};
	const FACTORIES = {
		
	};
	const METHODS = {
		programFilter:{
			value:function(child){
				return typeof child.setupProgram === "function";
			}
		},
	};
	const PROTOTYPE = {
		publish:{
			programquery:"",
		},
		setupRendertarget:function(x,y,width,height){
			const TARGET = this;
			const GL = this.gl;
			return Promise.all(this.$programs.map(function(e){
				e.x = x;
				e.y = y;
				e.width = width;
				e.height = height;
				return e.setupProgram(GL);
			})).then(function(passes){
				var pass,operation;
				TARGET.passes = passes;
				return function(){
					for(pass in passes){
						for(operation in passes[pass]){
							passes[pass][operation]();
						}
					}
				};
			},function(err){throw console.warn(err.stack)})
		},
	};
	Object.defineProperties(PROTOTYPE,BINDINGS);
	Object.defineProperties(PROTOTYPE,STATES);
	Object.defineProperties(PROTOTYPE,ACCESSORS);
	Object.defineProperties(PROTOTYPE,FACTORIES);
	Object.defineProperties(PROTOTYPE,METHODS);
	return PROTOTYPE;
})());
/*

*/</script>
</polymer-element>
