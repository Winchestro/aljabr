<link rel="import" href="gl-element.html">

<script>(function STATIC(){
	"use strict";
	const PROTOTYPE = Object.create(window["::gl-element::"].PROTOTYPE);
	const GL = WebGLRenderingContext.prototype;
	
	const ACCESSORS = {
		$width:{
			get:function(){
				return this.width||this.clientWidth||document.documentElement.clientWidth;
			}
		},
		$height:{
			get:function(){
				return this.height||this.clientHeight||document.documentElement.clientHeight;
			}
		},
		$programs:{
			get:function(){
				return [].slice.call(this.children).filter(this.programFilter.bind(this));
			}
		},
	};
	const BINDINGS = {
		viewport:function(x,y,width,height){
			this.gl.viewport(x,y,width,height);
			return this;
		},
	};
	const METHODS = {
		programFilter:function(child){
			return typeof child.setupProgram === "function";
		},
		setupRendertarget:function(x,y,width,height){
			const TARGET = this;
			const GL = this.gl;
			return Promise.all(this.$programs.map(function(e){
				e.x = x;
				e.y = y;
				e.width = width;
				e.height = height;
				return e.setupProgram(GL);
			})).then(function(passes){
				var pass,operation;
				TARGET.passes = passes;
				return function(){
					for(pass in passes){
						for(operation in passes[pass]){
							passes[pass][operation]();
						}
					}
				};
			},function(err){throw console.warn(err.stack)})
		},
	};

	PROTOTYPE.describeElement(PROTOTYPE,"gl-rendertarget",
		{
			bindings:BINDINGS,
			methods:METHODS
		},
		{
			accessors:ACCESSORS
		}
	);
	
})();
/*

*/</script>
