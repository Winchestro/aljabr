<link rel="import" href="gl-element.html">

<polymer-element name="gl-shader" constructor="glShader" extends="gl-element">
<script>Polymer((function STATIC(){
	"use strict;"
	const GL = WebGLRenderingContext.prototype;
	const BINDINGS = {
		createShader:{
			value:function(){
				this.shader = this.gl.createShader(this.type);
				return this;
			}
		},
		compileShader:{
			value:function(){
				this.gl.compileShader(this.shader);
				return this;
			}
		},
		deleteShader:{
			value:function(){
				this.gl.deleteShader(this.shader);
				return this;
			}
		},
		shaderSource:{
			value:function(code){
				this.gl.shaderSource(this.shader,code || this.code);
				return this;
			}
		},
	};
	const STATES = {
		$SHADER_TYPE:{
			get:function(){
				return this.gl.getShaderParameter(this.shader,GL.SHADER_TYPE);
			}
		},
		$DELETE_STATUS:{
			get:function(){
				return this.gl.getShaderParameter(this.shader,GL.DELETE_STATUS);
			}
		},
		$COMPILE_STATUS:{
			get:function(){
				return this.gl.getShaderParameter(this.shader,GL.COMPILE_STATUS);
			}
		},
	};
	const ACCESSORS = {
		source:{
			get:function(){
				return this.gl.getShaderSource(this.shader);
			}
		},
		infoLog:{
			get:function(){
				return this.gl.getShaderInfoLog(this.shader);
			}
		},
		type:{
			get:function(){
				return this.vertex?GL.VERTEX_SHADER:this.fragment?GL.FRAGMENT_SHADER:0;
			}
		}
	};
	const METHODS = {
		setupShader:{
			value:function(gl){
				if(!(gl instanceof WebGLRenderingContext))
					return new TypeError("First Argument not WebGLRenderingContext")
				this.gl = gl;
				if(this.src) return this.load(this.src);
				else         return Promise.resolve(this.processCode());
			}
		},
		processCode:{
			value:function(code){
				this.createShader()
				.shaderSource((this.includedCode||"") + (code || this.code))
				.compileShader();
				if(!this.$COMPILE_STATUS){
					console.warn(this.infoLog);
				}
				return this;
			}
		},
	};
	const PROTOTYPE = {
		publish:{
			code:"",
			includes:"",
			imports:"",
			vertex:false,
			fragment:false
		},
		includesChanged:function(o,n){
			var result = [];
			[].slice.call(document.querySelectorAll(n)).forEach(function(element){
				result.push(element.innerText);
			});
			this.includedCode = result.join("");
		},
	};
	Object.defineProperties(PROTOTYPE,BINDINGS);
	Object.defineProperties(PROTOTYPE,STATES);
	Object.defineProperties(PROTOTYPE,ACCESSORS);
	Object.defineProperties(PROTOTYPE,METHODS);
	return PROTOTYPE;
})());</script>
</polymer-element>