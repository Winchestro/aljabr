<link rel="import" href="../tier1/GLElement.html">
<link rel="import" href="../tier1/GLResource.html">
<link rel="import" href="../tier1/gl-vertexbuffer.html">
<link rel="import" href="OBJParser.html">
<script>(function STATIC(){
	"use strict";
	const GL 			= WebGLRenderingContext.prototype;
	const NS 			= Symbol.for("GLElements");
	const GLOBAL 		= window[NS];
	const PROTOTYPE 	= GLOBAL.Interface.GLElement;

	const OBJParser 	= GLOBAL.Class.OBJParser;

	const ATTRIBUTES = {
		src:"",
	};

	const METHODS = {
		created:function(){
			const isOBJ = /\.obj$/i.test(this.src);
			const xhr = new XMLHttpRequest;
			const GEOMETRY = this;
			xhr.open("GET",this.src);
			xhr.onreadystatechange = function(){
				if(xhr.readyState === xhr.DONE && xhr.status === 200){
					if(isOBJ){
						/*
						var DATA = OBJParser.toIndexedArrays(xhr.response);
						for(var buffer in DATA) DATA[buffer] = new Float32Array(DATA[buffer].reduce(
							(p,c)=>p.concat(c)
						));
						
						console.log("elements",DATA);
						DATA = OBJParser.toArrays(xhr.response);
						for(var buffer in DATA){
							if(buffer === "f"){
								DATA.f = new Uint16Array(DATA.f.reduce((p,c)=>p.concat(c)));
							}else{
								DATA[buffer] = new Float32Array(DATA[buffer].reduce((p,c)=>p.concat(c)));
							}
						}

						console.log("indexed arrays",DATA);
						*/
						//GEOMETRY.$.v.data = new Float32Array(DATA[0]);
						//GEOMETRY.$.vt.data = new Float32Array(DATA[1]);
						//GEOMETRY.$.vn.data = new Float32Array(DATA[2]);
					}
				}
			}
			xhr.send();
		}
	};

	new GLOBAL.Element(PROTOTYPE,"gl-geometry")
		.copy(ATTRIBUTES,"attributes")
		.copy(METHODS,"methods")
	;
})();
/*
*/</script>
