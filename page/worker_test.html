<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
		<title>GLElements Test</title>

		<iframe src="../bin/core.html"></iframe>
		<style>
			body {
				display	: inline-block;
			}
			canvas {
				width : 100%;
				height : 100%;
				position: fixed;
				top : 0;
				left : 0;
				z-index : -1;
				background : #888;
			}
			iframe {
				display : none;
			}
		</style>
	</head>
	<body>
		<script>
			"use strict";
			
			function main() {}

			function DBQueue( target ){
				this.target = target;
				this.result = null;
				this.queue = [];
			};
			DBQueue.prototype = {
				pushCommand : function ( args ) {
					this.queue.push( args );
					if ( this.queue.length === 1 ) this.execCommand();
				},
				shiftCommand : function ( ) {
					this.queue.shift();
				},
				execCommand : function ( ) {
					var args = this.queue[ 0 ];
					var request = this.target[ args.command ].apply( this.target, args )
					request.addEventListener( "success", this );
					request.addEventListener( "error", this );
					request.addEventListener( "upgradeneeded", this );
				},
				open : function ( name, version ) {
					arguments.command = "open";
					this.pushCommand( arguments );
					return this;
				},
				delete : function ( name ) {
					arguments.command = "deleteDatabase";
					this.pushCommand( arguments );
					return this;
				},
				cmp : function ( ) {
					arguments.command = "cmp";
					this.pushCommand( arguments );
					return this;
				},
				getNames : function ( ) {
					arguments.command = "webkitGetDatabaseNames";
					this.pushCommand( arguments );
					return this;
				},
				handleEvent : function ( e ) {
					console.log( e.type, e, e.target, e.target.result, this.queue );
					this.shiftCommand();
					switch ( e.type ) {
						case "success" :
							this.result = e.target.result;
							this.execCommand();
						break;
						case "upgradeneeded" :
							if ( this.upgrade ) this.upgrade();
						break;
					}
				}
			};
			//for ( var property in methods ) DBQueue.prototype[ property ] = methods[ property ];
			
			var db = new DBQueue( indexedDB ).delete( "testDB" ).open( "testDB", 1 );
			db.getNames();
			//indexedDB.deleteDatabase( "testDB" ).addEventListener( "success", dbReader );
			
			//indexedDB.open( "testDB", 1 ).addEventListener( "success", dbReader );



			/*
			var worker = new Worker("testworker.js");
			var f = new Float32Array( 16 );

			console.log( "buffer", f, f.buffer );
			worker.postMessage( f.buffer, [ f.buffer ] );
			console.log( "buffer transfered", f, f.buffer );
			worker.addEventListener( "message", function ( result ) {
				console.log( "worker response", result );
				console.log( "buffer returned", new Float32Array( result.data ) );
			} );
			*/
		</script>
	</body>
</html>